import{i as t,C as e}from"./vendor-CcYgj9Uj.js";const r=/_key\s*==\s*['"](.*)['"]/;function n(t){if(!Array.isArray(t))throw new Error("Path is not an array");return t.reduce((t,e,n)=>{const o=typeof e;if("number"===o)return`${t}[${e}]`;if("string"===o)return`${t}${0===n?"":"."}${e}`;if(function(t){return"string"==typeof t?r.test(t.trim()):"object"==typeof t&&"_key"in t}(e)&&e._key)return`${t}[_key=="${e._key}"]`;if(Array.isArray(e)){const[r,n]=e;return`${t}[${r}:${n}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(e)}\``)},"")}const o={"\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","'":"\\'","\\":"\\\\"},s={"\\f":"\f","\\n":"\n","\\r":"\r","\\t":"\t","\\'":"'","\\\\":"\\"};function i(t){const e=[],r=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let n;for(;null!==(n=r.exec(t));){if(void 0!==n[1]){const t=n[1].replace(/\\(\\|f|n|r|t|')/g,t=>s[t]);e.push(t);continue}if(void 0===n[2]){if(void 0!==n[3]){const t=n[3].replace(/\\(\\')/g,t=>s[t]);e.push({_key:t,_index:-1});continue}}else e.push(parseInt(n[2],10))}return e}function a(t){return t.map(t=>{if("string"==typeof t||"number"==typeof t)return t;if(""!==t._key)return{_key:t._key};if(-1!==t._index)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)})}function c(t,e){if(!e?.mappings)return;const r=function(t){return`$${t.map(t=>"string"==typeof t?`['${t.replace(/[\f\n\r\t'\\]/g,t=>o[t])}']`:"number"==typeof t?`[${t}]`:""!==t._key?`[?(@._key=='${t._key.replace(/['\\]/g,t=>o[t])}')]`:`[${t._index}]`).join("")}`}(t.map(t=>{if("string"==typeof t||"number"==typeof t)return t;if(-1!==t._index)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)}));if(void 0!==e.mappings[r])return{mapping:e.mappings[r],matchedPath:r,pathSuffix:""};const n=Object.entries(e.mappings).filter(([t])=>r.startsWith(t)).sort(([t],[e])=>e.length-t.length);if(0==n.length)return;const[s,i]=n[0];return{mapping:i,matchedPath:s,pathSuffix:r.substring(s.length)}}function u(e,r,n=[]){if(function(t){return null!==t&&Array.isArray(t)}(e))return e.map((e,o)=>{if(t(e)){const t=e._key;if("string"==typeof t)return u(e,r,n.concat({_key:t,_index:o}))}return u(e,r,n.concat(o))});if(t(e)){if("block"===e._type||"span"===e._type){const t={...e};return"block"===e._type?t.children=u(e.children,r,n.concat("children")):"span"===e._type&&(t.text=u(e.text,r,n.concat("text"))),t}return Object.fromEntries(Object.entries(e).map(([t,e])=>[t,u(e,r,n.concat(t))]))}return r(e,n)}function p(t,e,r){return u(t,(t,n)=>{if("string"!=typeof t)return t;const o=c(n,e);if(!o)return t;const{mapping:s,matchedPath:a}=o;if("value"!==s.type||"documentValue"!==s.source.type)return t;const u=e.documents[s.source.document],p=e.paths[s.source.path],l=i(a),f=i(p).concat(n.slice(l.length));return r({sourcePath:f,sourceDocument:u,resultPath:n,value:t})})}const l=".",f=`drafts${l}`,d=`versions${l}`;function h(t){return t.startsWith(f)}function g(t){return t.startsWith(d)}function y(t){const{baseUrl:e,workspace:r="default",tool:o="default",id:s,type:i,path:c,projectId:u,dataset:p}=t;if(!e)throw new Error("baseUrl is required");if(!c)throw new Error("path is required");if(!s)throw new Error("id is required");if("/"!==e&&e.endsWith("/"))throw new Error("baseUrl must not end with a slash");const d="default"===r?void 0:r,y="default"===o?void 0:o,m=function(t){return g(t)?t.split(l).slice(2).join(l):h(t)?t.slice(f.length):t}(s),$=Array.isArray(c)?n(a(c)):c,w=new URLSearchParams({baseUrl:e,id:m,type:i,path:$});if(d&&w.set("workspace",d),y&&w.set("tool",y),u&&w.set("projectId",u),p&&w.set("dataset",p),function(t){return!h(t)&&!g(t)}(s))w.set("perspective","published");else if(g(s)){const t=function(t){if(!g(t))return;const[e,r,...n]=t.split(l);return r}(s);w.set("perspective",t)}const _=["/"===e?"":e];d&&_.push(d);const b=["mode=presentation",`id=${m}`,`type=${i}`,`path=${encodeURIComponent($)}`];return y&&b.push(`tool=${y}`),_.push("intent","edit",`${b.join(";")}?${w}`),_.join("/")}const m=({sourcePath:t,resultPath:e,value:r})=>{if(/^\d{4}-\d{2}-\d{2}/.test(n=r)&&Date.parse(n)||function(t){try{const{protocol:e}=new URL(t,t.startsWith("/")?"https://acme.com":void 0);return w.has(e)||e.startsWith("web+")}catch{return!1}}(r))return!1;var n;const o=t.at(-1);return!("slug"===t.at(-2)&&"current"===o||"string"==typeof o&&(o.startsWith("_")||o.endsWith("Id"))||t.some(t=>"meta"===t||"metadata"===t||"openGraph"===t||"seo"===t)||_(t)||_(e)||"string"==typeof o&&$.has(o))},$=new Set(["color","colour","currency","email","format","gid","hex","href","hsl","hsla","icon","id","index","key","language","layout","link","linkAction","locale","lqip","page","path","ref","rgb","rgba","route","secret","slug","status","tag","template","theme","type","textTheme","unit","url","username","variant","website"]);const w=new Set(["app:","data:","discord:","file:","ftp:","ftps:","geo:","http:","https:","imap:","javascript:","magnet:","mailto:","maps:","ms-excel:","ms-powerpoint:","ms-word:","slack:","sms:","spotify:","steam:","teams:","tel:","vscode:","zoom:"]);function _(t){return t.some(t=>"string"==typeof t&&null!==t.match(/type/i))}function b(t,n,o){const{filter:s,logger:i,enabled:a}=o;if(!a){const e="config.enabled must be true, don't call this function otherwise";throw i?.error?.(`[@sanity/client]: ${e}`,{result:t,resultSourceMap:n,config:o}),new TypeError(e)}if(!n)return i?.error?.("[@sanity/client]: Missing Content Source Map from response body",{result:t,resultSourceMap:n,config:o}),t;if(!o.studioUrl){const e="config.studioUrl must be defined";throw i?.error?.(`[@sanity/client]: ${e}`,{result:t,resultSourceMap:n,config:o}),new TypeError(e)}const c={encoded:[],skipped:[]},u=p(t,n,({sourcePath:t,sourceDocument:r,resultPath:n,value:a})=>{if(!1===("function"==typeof s?s({sourcePath:t,resultPath:n,filterDefault:m,sourceDocument:r,value:a}):m({sourcePath:t,resultPath:n,value:a})))return i&&c.skipped.push({path:k(t),value:`${a.slice(0,20)}${a.length>20?"...":""}`,length:a.length}),a;i&&c.encoded.push({path:k(t),value:`${a.slice(0,20)}${a.length>20?"...":""}`,length:a.length});const{baseUrl:u,workspace:p,tool:l}=function(t){let e="string"==typeof t?t:t.baseUrl;return"/"!==e&&(e=e.replace(/\/$/,"")),"string"==typeof t?{baseUrl:e}:{...t,baseUrl:e}}("function"==typeof o.studioUrl?o.studioUrl(r):o.studioUrl);if(!u)return a;const{_id:f,_type:d,_projectId:h,_dataset:g}=r;return e(a,{origin:"sanity.io",href:y({baseUrl:u,workspace:p,tool:l,id:f,type:d,path:t,...!o.omitCrossDatasetReferenceData&&{dataset:g,projectId:h}})},!1)});if(i){const t=c.skipped.length,e=c.encoded.length;if((t||e)&&((i?.groupCollapsed||i.log)?.("[@sanity/client]: Encoding source map into result"),i.log?.(`[@sanity/client]: Paths encoded: ${c.encoded.length}, skipped: ${c.skipped.length}`)),c.encoded.length>0&&(i?.log?.("[@sanity/client]: Table of encoded paths"),(i?.table||i.log)?.(c.encoded)),c.skipped.length>0){const t=new Set;for(const{path:e}of c.skipped)t.add(e.replace(r,"0").replace(/\[\d+\]/g,"[]"));i?.log?.("[@sanity/client]: List of skipped paths",[...t.values()])}(t||e)&&i?.groupEnd?.()}return u}function k(t){return n(a(t))}var v=Object.freeze({__proto__:null,stegaEncodeSourceMap:b});export{p as encodeIntoResult,b as stegaEncodeSourceMap,v as stegaEncodeSourceMap$1};
